<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Think Engine — Strategic Analysis</title>
<meta name="description" content="Think Engine — Scenario & Expected Value Analysis Tool">
<meta name="theme-color" content="#0e1117">

<link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
<link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Think Engine">

<style>
:root{
--bg:#0e1117;
--panel:#161b22;
--card:#1f2633;
--muted:#8b949e;
--accent:#e5533d;
--positive:#2ea043;
--negative:#f85149;
--color-a: #ff4d4d;
--color-b: #4d94ff;
--font-size-base: 15px;
--font-size-small: 13px;
--padding-base: 16px;
}

*{box-sizing:border-box}
body{
margin:0; font-family:system-ui,-apple-system,sans-serif;
background:var(--bg); color:#fff; font-size: var(--font-size-base);
}

.wrapper{ max-width:800px; margin:auto; padding:var(--padding-base); }
.header{ text-align:center; margin-bottom:24px; }
.header h1{ margin:0; font-size:26px; }
.header p{ margin:6px 0 0; font-size:var(--font-size-small); color:var(--muted); }

.section{
background:var(--panel); border-radius:16px; padding:var(--padding-base); margin-bottom:16px;
}

.match{
background:var(--card); border-radius:14px; padding:14px; margin-bottom:12px;
position: relative; padding-top: 30px;
}

.remove-match {
position: absolute; top: 5px; right: 5px; width: 30px; height: 30px;
background: none; border: none; color: var(--muted); font-size: 20px;
cursor: pointer; display: flex; align-items: center; justify-content: center;
}

.grid-input-group { display: grid; grid-template-columns: 1fr 100px; gap: 8px; }
.vs{ text-align:center; font-size:var(--font-size-small); color:var(--muted); margin:8px 0; }

input{
width:100%; padding:12px; border-radius:10px; border:none;
background:#0d1117; color:#fff; font-size:var(--font-size-base);
}

.actions{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px; }
#addMatchBtn {
width: 100%; padding: 12px; margin-top: 10px; background: #21262d;
color: var(--muted); border: 1px dashed #30363d; border-radius: 14px; cursor: pointer;
}

button{ padding:14px; border:none; border-radius:14px; font-size:var(--font-size-base); cursor:pointer; }
.calc{ background:var(--accent); color:#fff; font-weight: 600; }
.clear{ background:#21262d; color:#fff; }

.summary{
background:linear-gradient(135deg,#1f2633,#161b22); border-radius:16px;
padding:var(--padding-base); margin-bottom:16px; border: 1px solid #30363d;
}
.summary h2 { margin: 0 0 10px 0; font-size: 18px; color: #fff; }
.summary div { font-size: 15px; margin-bottom: 6px; color: var(--muted); }
.summary hr { border: 0; border-top: 1px solid #30363d; margin: 12px 0; }
.summary .ev-value { font-size: 20px; font-weight: bold; display: block; margin-top: 4px; }

.card{
background:var(--card); border-radius:14px; padding:16px;
margin-bottom:10px; font-size:var(--font-size-small); position: relative;
border-left: 4px solid transparent;
}

.tag-a { color: var(--color-a); font-weight: bold; }
.tag-b { color: var(--color-b); font-weight: bold; }

.star-btn {
position: absolute; top: 8px; right: 8px;
background: rgba(255,255,255,0.05); border-radius: 8px;
border: none; color: #444; font-size: 20px;
width: 36px; height: 36px; cursor: pointer;
display: flex; align-items: center; justify-content: center;
transition: all 0.2s ease;
}
.star-btn.active { color: #ffcc00; background: rgba(255, 204, 0, 0.1); }

.positive{ border-left-color: var(--positive); }
.negative{ border-left-color: var(--negative); }

.metric{ display:flex; justify-content:space-between; margin-top:8px; line-height: 1.4; }
.metric span{ color:var(--muted); padding-right: 10px; }
.scenario-label { padding-right: 40px; margin-bottom: 10px; display: block; line-height: 1.6; }
</style>
</head>

<body onload="initializeMatches()">
<div class="wrapper">
<div class="header">
<h1>Think Engine</h1>
<p>วิเคราะห์ผลตอบแทนและสถิติจุดคุ้มทุน</p>
</div>

<div class="section">
<b>คะแนนเดิมพัน (Stake)</b>
<input id="totalStakeInput" type="number" step="1" placeholder="ระบุทุนเดิมพัน" oninput="saveData()" style="margin-top:10px;">
</div>

<div class="section">
<b>คู่แข่งขัน / Scenario</b>
<div id="matches"></div>
<button id="addMatchBtn" onclick="addMatch()">+ เพิ่มรายการสเต็ป</button>
</div>

<div class="actions">
<button class="calc" onclick="calculate()">คำนวณเชิงสถิติ</button>
<button class="clear" onclick="resetAll()">ล้างค่า</button>
</div>

<div id="result"></div>
</div>

<script>
const matchesDiv = document.getElementById("matches");
const resultDiv = document.getElementById("result");
const totalStakeInput = document.getElementById("totalStakeInput");
const LOCAL_STORAGE_KEY = 'thinkEngine_Strategic_V_Final';
let matchCounter = 0;

function saveData() {
const matches = document.querySelectorAll(".match");
let matchData = [];
matches.forEach(m => {
const i = m.querySelectorAll("input");
matchData.push({ id: m.id, A: i[0].value, OddsA: i[1].value, B: i[2].value, OddsB: i[3].value });
});
localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify({ stake: totalStakeInput.value, matches: matchData }));
}

function createMatchHTML(id, values = {}) {
return `
<div class="match" id="${id}">
<button class="remove-match" onclick="removeMatch('${id}')">×</button>
<div class="grid-input-group">
<input placeholder="Scenario A (แดง)" value="${values.A || ""}" oninput="saveData()">
<input type="number" step="0.01" placeholder="Odds" value="${values.OddsA || ""}" oninput="saveData()">
</div>
<div class="vs">VS</div>
<div class="grid-input-group">
<input placeholder="Scenario B (น้ำเงิน)" value="${values.B || ""}" oninput="saveData()">
<input type="number" step="0.01" placeholder="Odds" value="${values.OddsB || ""}" oninput="saveData()">
</div>
</div>`;
}

function addMatch() {
const newId = `match-${matchCounter++}`;
matchesDiv.insertAdjacentHTML('beforeend', createMatchHTML(newId));
saveData();
}

function removeMatch(id) { document.getElementById(id)?.remove(); saveData(); }

function initializeMatches() {
const stored = localStorage.getItem(LOCAL_STORAGE_KEY);
if (stored) {
const data = JSON.parse(stored);
totalStakeInput.value = data.stake || "";
data.matches.forEach(m => matchesDiv.insertAdjacentHTML('beforeend', createMatchHTML(m.id, m)));
matchCounter = data.matches.length > 0 ? Math.max(...data.matches.map(m => parseInt(m.id.split('-')[1]))) + 1 : 0;
} else { for(let i = 0; i < 3; i++) addMatch(); }
}

function toggleStar(btn) {
btn.classList.toggle('active');
btn.innerHTML = btn.classList.contains('active') ? '★' : '☆';
}

function calculate(){
const matches = document.querySelectorAll(".match");
const totalStake = +totalStakeInput.value;
let data = [];

if (totalStake <= 0) {
resultDiv.innerHTML = `<div style="color:var(--negative); padding:10px;">❌ กรุณากรอก Stake</div>`;
return;
}

matches.forEach((m, idx) => {
const i = m.querySelectorAll("input");
if (+i[1].value > 1 && +i[3].value > 1) {
data.push({ A: i[0].value || `คู่ที่ ${idx+1} (A)`, Am: +i[1].value, Pa: 1/+i[1].value, B: i[2].value || `คู่ที่ ${idx+1} (B)`, Bm: +i[3].value, Pb: 1/+i[3].value });
}
});

if (data.length === 0) return;

let scenarios = [];
let totalAverageEV = 0; let maxGain = -Infinity; let maxLoss = Infinity;

function walk(idx, htmlLabel, multi, prob){
if(idx === data.length){
const ret = multi * totalStake;
const ev = ret - totalStake;
const roi = (ev / totalStake) * 100;
totalAverageEV += ev * prob;
if (ev > maxGain) maxGain = ev; if (ev < maxLoss) maxLoss = ev;
scenarios.push({ label: htmlLabel, multi, prob, ev, ret, roi });
return;
}
walk(idx + 1, htmlLabel + `<span class="tag-a">${data[idx].A}</span> | `, multi * data[idx].Am, prob * data[idx].Pa);
walk(idx + 1, htmlLabel + `<span class="tag-b">${data[idx].B}</span> | `, multi * data[idx].Bm, prob * data[idx].Pb);
}

walk(0, "", 1, 1);
scenarios.sort((a,b) => b.ev - a.ev);

resultDiv.innerHTML = `
<div class="summary">
<h2>Summary</h2>
<div>Scenarios: <b>${scenarios.length}</b></div>
<div>Stake: <b>${totalStake.toFixed(2)} หน่วย</b></div>
<div>Max Gain: <b style="color:var(--positive)">+${maxGain.toFixed(2)}</b></div>
<div>Max Loss: <b style="color:var(--negative)">${maxLoss.toFixed(2)}</b></div>
<hr>
<span style="color:var(--muted); font-size:14px;">Average Expected Value (EV)</span>
<span class="ev-value ${totalAverageEV >= 0 ? 'ev-positive' : 'ev-negative'}">${totalAverageEV.toFixed(2)} หน่วย</span>
</div>
` + scenarios.map(s => `
<div class="card ${s.ev >= 0 ? "positive" : "negative"}">
<button class="star-btn" onclick="toggleStar(this)">☆</button>
<b class="scenario-label">${s.label.replace(/ \| $/, '')}</b>
<div class="metric"><span>Probability</span><b>${(s.prob * 100).toFixed(2)}%</b></div>
<div class="metric"><span>Return (Stake + Profit)</span><b>${totalStake.toFixed(2)} + ${s.ev.toFixed(2)} = ${s.ret.toFixed(2)}</b></div>
<div class="metric"><span>EV (Net Profit)</span><b style="color:${s.ev >= 0 ? 'var(--positive)' : 'var(--negative)'}">${s.ev.toFixed(2)}</b></div>
<div class="metric"><span>ROI (%)</span><b style="color:${s.roi >= 0 ? 'var(--positive)' : 'var(--negative)'}">${s.roi.toFixed(2)}%</b></div>
</div>`).join("");
}

function resetAll(){ localStorage.removeItem(LOCAL_STORAGE_KEY); location.reload(); }
</script>
</body>
</html>
